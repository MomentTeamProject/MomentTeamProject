<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="webBoard.mapper">


<select id="total" resultType="integer">
	select count(*) from m_board <include refid="search_where" />
</select>

<select id="list" resultType="web.board.WebBoardVO">
	select b.*, (select u_nick from m_user where u_userid=b.b_userid) b_nick 
	from (select rownum no, b.* 
		  from (select * from m_board <include refid="search_where" /> order by b_no) b 
		  order by no desc) b
	where no between #{beginList} and #{endList}
</select>


<!-- 공통 쿼리문 작성 -->
<sql id="search_writer">
	u_userid in (select u_userid from m_user where name like '%' || #{keyword} || '%')
</sql>

<sql id="search_where">
	<if test="search=='title' or search=='content'">
		where ${search} like '%' || #{keyword} || '%'
	</if>
	<if test="search=='writer'">
		where <include refid="search_writer"/>
	</if>
	<if test="search=='all'">
		where b_title  like '%' || #{keyword} || '%'
		or b_coment like '%' || #{keyword} || '%'
		or <include refid="search_writer"/>
	</if>
</sql>



<!-- 새글 저장 -->


<insert id="insert">
	INSERT INTO m_board (b_no, b_userid, b_title, b_coment, b_imgpath, b_local, b_tag, b_writedate, b_latitude, b_longitude, b_ddabong, b_readcnt)
	VALUES (m_board_seq.nextval, #{b_userid}, #{b_title}, #{b_coment}, #{b_imgpath}, #{b_local}, DEFAULT , SYSDATE , #{b_latitude}, #{b_longitude}, DEFAULT, DEFAULT)
	</insert>











</mapper>